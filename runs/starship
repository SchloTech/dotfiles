#!/usr/bin/env bash

# Source the OS detection utility
source "$(dirname "$(dirname "$0")")/utils/os_detect.sh"

# Check if Starship is already installed
if command -v starship &>/dev/null; then
    echo "Starship is already installed."
    exit 0
fi

echo "Installing Starship..."

# Install using the official installer
curl -sS https://starship.rs/install.sh | sh

# Function to configure shell
configure_shell() {
    local shell_rc="$1"
    local init_line='eval "$(starship init bash)"'
    
    if [[ "$shell_rc" == *"zsh"* ]]; then
        init_line='eval "$(starship init zsh)"'
    fi
    
    # Check if Starship is already configured
    if ! grep -q "starship init" "$shell_rc" 2>/dev/null; then
        echo -e "\n# Initialize Starship prompt\n$init_line" >> "$shell_rc"
        echo "Configured Starship for $(basename "$shell_rc")"
    fi
}

# Configure for Bash
if [[ -f "$HOME/.bashrc" ]]; then
    configure_shell "$HOME/.bashrc"
fi

# Configure for Zsh
if [[ -f "$HOME/.zshrc" ]]; then
    configure_shell "$HOME/.zshrc"
fi

echo "Starship installation complete!"
echo "Please restart your shell or run 'source ~/.bashrc' (or ~/.zshrc) to start using Starship."

